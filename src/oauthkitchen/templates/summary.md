# OAuthKitchen Security Report

**Tenant:** {{ tenant_id }}
**Generated:** {{ timestamp }}
**Mode:** {{ mode }}{% if not sign_in_data_available %} (Sign-in logs not available){% endif %}

---

## Executive Summary

| Metric | Count |
|--------|-------|
| Total App Registrations | {{ total_apps }} |
| Total Enterprise Apps (SPs) | {{ total_service_principals }} |
| Critical Risk | {{ critical_count }} |
| High Risk | {{ high_risk_count }} |
| Apps Without Owners | {{ apps_without_owners }} |
| Credentials Expiring <30 days | {{ expiring_credentials_30_days }} |

---

## ðŸ”´ Top 10 Findings

{% for sp, score in top_risky_apps %}
{{ loop.index }}. **{{ sp.display_name }}** ({{ score.risk_level }}, Score: {{ score.total_score }})
   - App ID: `{{ sp.app_id }}`
   - Type: {{ sp.app_type.value }}
   - Top concern: {{ score.factors[0].name if score.factors else 'N/A' }}
{% endfor %}

---

## ðŸ‘» Shadow OAuth Findings

{% if shadow_findings %}
| Severity | Title | App Name | Affected Users |
|----------|-------|----------|----------------|
{% for finding in shadow_findings[:10] %}
| {{ finding.severity }} | {{ finding.title }} | {{ finding.service_principal_name }} | {{ finding.affected_user_count }} |
{% endfor %}
{% if shadow_findings|length > 10 %}
*... and {{ shadow_findings|length - 10 }} more findings*
{% endif %}
{% else %}
âœ… No shadow OAuth patterns detected.
{% endif %}

---

## ðŸ“… Upcoming Credential Expirations

{% if credential_findings %}
| App Name | Credential Type | Days Until Expiry | Severity |
|----------|-----------------|-------------------|----------|
{% for cred in credential_findings[:10] %}
| {{ cred.app_name }} | {{ cred.credential_type.value }} | {{ cred.expires_in_days }} | {{ cred.severity }} |
{% endfor %}
{% if credential_findings|length > 10 %}
*... and {{ credential_findings|length - 10 }} more credentials*
{% endif %}
{% else %}
âœ… No credentials expiring in the next 90 days.
{% endif %}

---

## Risk Level Distribution

| Risk Level | Count |
|------------|-------|
| Critical | {{ critical_count }} |
| High | {{ high_risk_count }} |
| Medium | {{ medium_count }} |
| Low | {{ low_count }} |

---

{% if mode == 'limited' %}
> âš ï¸ **Limited Mode Notice:** Sign-in activity data was not available during this scan.
> Some risk indicators (inactive apps, usage patterns) may be incomplete.
> This typically requires `AuditLog.Read.All` permission and Azure AD P1/P2 license.
{% endif %}

---

*Report generated by OAuthKitchen v{{ version }}*
*This report is for security review purposes. Always verify findings before taking action.*